#!/usr/bin/env bash

# List of required remark plugins
plugins=(
  remark-lint-fenced-code-flag
  remark-lint-no-heading-like-paragraph
  remark-lint-no-literal-urls
  remark-lint-no-consecutive-blank-lines
  remark-lint-fenced-code-marker
  remark-lint-strong-marker
  remark-lint-heading-style
  remark-lint-no-heading-punctuation
  remark-lint-no-blockquote-without-marker
  remark-lint-blockquote-indentation
  remark-lint-code-block-style
  remark-lint-definition-spacing
  remark-lint-no-heading-content-indent
  remark-lint-definition-case
  remark-lint-final-definition
  remark-lint-no-duplicate-definitions
  remark-lint-no-duplicate-headings
  remark-lint-no-emphasis-as-heading
  remark-lint-no-file-name-irregular-characters
  remark-lint-no-file-name-articles
  remark-lint-heading-increment
  remark-lint-link-title-style
  remark-lint-list-item-bullet-indent
  remark-lint-checkbox-character-style
  remark-lint-list-item-spacing
  remark-lint-no-multiple-toplevel-headings
  remark-lint-no-unused-definitions
  remark-lint-no-shell-dollars
  remark-lint-no-shortcut-reference-image
  remark-lint-no-shortcut-reference-link
  remark-lint-table-cell-padding
  remark-lint-table-pipe-alignment
  remark-lint-table-pipes
  remark-lint-no-table-indentation
  remark-lint-list-item-content-indent
  remark-lint-ordered-list-marker-style
  remark-lint-unordered-list-marker-style
  remark-lint-ordered-list-marker-value
  remark-lint-list-item-indent
  remark-lint-rule-style
  remark-lint-no-undefined-references
)

if [[ ! -f $1 ]]; then
  echo "File '$1' does not exist. Exiting."
  exit 1
fi

# Build plugin install list
plugin_list=$(printf " %s" "${plugins[@]}")

echo "Auto-fixing markdown file (where possible)..."

docker run --rm -v "${PWD}:/src" -w /src node:alpine sh -c "
  npm install -g remark-cli${plugin_list} &&
  npx remark \"$1\" --output
"
